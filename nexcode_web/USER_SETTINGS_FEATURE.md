# 用户设置功能说明

## 概述

NexCode Web 现在提供了完整的用户设置功能，包括个人资料管理和 Personal Access Tokens 管理，类似 GitHub 的用户体验。

## 功能特性

### 1. 用户头像下拉菜单

- **位置**: 右上角用户头像
- **功能**: 点击头像显示下拉菜单
- **菜单项**:
  - 个人资料
  - Personal Access Tokens
  - 退出登录

### 2. 个人资料页面

- **访问方式**: 点击头像 → 个人资料
- **功能**:
  - 显示用户基本信息（用户名、邮箱）
  - 账户安全提示
  - 只读模式（修改需联系管理员）

### 3. Personal Access Tokens 管理

- **访问方式**: 
  - 点击头像 → Personal Access Tokens
  - 直接访问 `/settings?tab=tokens`
- **功能**:
  - 查看现有 Tokens 列表
  - 创建新的 Personal Access Token
  - 设置 Token 权限范围
  - 配置速率限制和过期时间
  - 删除 Token
  - 复制 Token 到剪贴板

## 技术实现

### 文件结构

```
nexcode_web/src/
├── pages/
│   └── settings.tsx          # 用户设置页面（全屏布局）
├── components/
│   └── Layout.tsx            # 更新了头像下拉菜单
└── types/
    └── api.ts               # 添加了 APIKey 和 TokenScope 类型
```

### 主要组件

1. **Layout.tsx**: 
   - 添加了用户头像下拉菜单
   - 支持点击外部关闭菜单
   - 响应式设计

2. **settings.tsx**:
   - **全屏布局设计**：不依赖Layout组件，避免重复导航栏
   - 标签页式设计（个人资料 / Personal Access Tokens）
   - 支持 URL 参数直接跳转到特定标签页
   - 模态框创建 Token
   - 完整的 Token 管理功能
   - 独立的导航栏和用户菜单

### 布局特点

- **全屏设计**: settings页面使用独立的全屏布局
- **无重复导航**: 避免了Layout组件导致的重复导航栏问题
- **一致性**: 保持了与其他页面相同的导航栏样式
- **响应式**: 适配不同屏幕尺寸

### API 集成

- 使用现有的 `/v1/users/me/api-keys` 接口
- 支持 Token 的创建、删除、查看
- 权限范围管理
- 速率限制配置

## 用户体验

### 设计原则

1. **一致性**: 遵循 GitHub 的设计模式
2. **易用性**: 直观的导航和操作流程
3. **安全性**: Token 只显示一次，支持隐藏/显示
4. **响应式**: 适配不同屏幕尺寸
5. **全屏体验**: 设置页面提供沉浸式的全屏体验

### 交互流程

1. **访问设置**: 点击右上角头像 → 选择菜单项
2. **创建 Token**: 
   - 进入 Personal Access Tokens 标签页
   - 点击"新建Token"
   - 填写 Token 名称和权限
   - 创建成功后复制 Token
3. **管理 Token**: 
   - 查看使用统计
   - 删除不需要的 Token
   - 查看过期时间

## 安全考虑

1. **Token 显示**: 创建时只显示一次，之后无法查看完整 Token
2. **权限控制**: 支持细粒度的权限范围设置
3. **速率限制**: 可配置 API 调用频率限制
4. **过期时间**: 支持设置 Token 过期时间

## 未来扩展

1. **Token 使用日志**: 显示 Token 的详细使用记录
2. **批量操作**: 支持批量删除或更新 Token
3. **更多设置**: 用户偏好设置、通知设置等
4. **API 文档**: 集成 Token 使用示例和文档 